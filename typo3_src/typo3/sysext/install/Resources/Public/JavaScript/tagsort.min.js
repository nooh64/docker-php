!function(a){a.fn.tagSort=function(b){var c={selector:".item-tagsort",tagWrapper:"span",tagClassPrefix:!1,displaySelector:!1,displaySeperator:" ",sortType:"exclusive",fadeTime:200};b=a.extend(c,b);var d={generateTags:function(c){var e={},f={elements:[],tags:[]},g=a(document.createElement(b.tagWrapper));return c.each(function(c){$element=a(this);var h=$element.data("item-tags"),i=h.match(/,\s+/)?h.split(", "):h.split(",");a.each(i,function(a,c){var f=c.toLowerCase();e[f]||(e[f]=[],d.container.append(b.tagClassPrefix!==!1?g.clone().text(c).addClass((b.tagClassPrefix+c.toLowerCase()).replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,"")):g.clone().text(c))),b.displaySelector!==!1&&$element.find(b.displaySelector).append(a>0?b.displaySeperator+c:c),e[f].push($element)}),f.elements.push($element),f.tags.push(i)}),"inclusive"==b.sortType?e:"exclusive"==b.sortType?f:"single"==b.sortType?e:void 0},exclusiveSort:function(b,c){var e=[[],[]];return a.each(b.elements,function(c,f){var g=!0;d.container.find(".tagsort-active").each(function(d){b.tags[c].indexOf(a(this).text())==-1&&(g=!1,e[0].push(f))}),1==g&&e[1].push(f)}),e},inclusiveSort:function(b,c){var e=[[],[]];return d.container.find(".tagsort-active").each(function(c){a.each(b[a(this).text().toLowerCase()],function(a,b){e[1].push(b)})}),e},showElements:function(c){a.each(c,function(a,c){c.is("visible")||c.fadeIn(b.fadeTime)})},hideElements:function(c){a.each(c,function(a,c){c.is("visible")&&c.fadeOut(b.fadeTime)})},inititalize:function(c){d.container=c,d.container.addClass("tagsort-tags-container");var e=a(b.selector);d.tags=d.generateTags(e,d.container);var f=d.container.find(b.tagWrapper);f.click(function(){var c=f.hasClass("tagsort-active");if(c||e.fadeIn(b.fadeTime),e.fadeOut(b.fadeTime),"single"==b.sortType)if(a(this).hasClass("tagsort-active"))e.fadeIn(b.fadeTime),a(this).removeClass("tagsort-active");else{a(".tagsort-active").removeClass("tagsort-active"),a(this).toggleClass("tagsort-active");var g=d.inclusiveSort(d.tags,e)}else{a(this).toggleClass("tagsort-active");var g="inclusive"==b.sortType?d.inclusiveSort(d.tags,e):d.exclusiveSort(d.tags,e)}g[0].length>0&&d.hideElements(g[0]),g[1].length>0&&d.showElements(g[1])})}};return d.inititalize(this),a(this)}}(jQuery);